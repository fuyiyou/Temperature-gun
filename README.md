# Temperature-gun
	随着社会与科技的发展，人类越来越注重个人的身体健康，常在家中备有一个药品或者是相关的身体检测的工具，基中最为常见的体温计，特别家庭当中有小孩，体温计是必不可少的。体温的测量最为常见的水银体温计，水银体温体有着明显的缺点，一是体温测量时间较久，一般需要5分钟左右，二要求测量位置唯一性，只能在腋下，三是小孩测量需要大人陪同方可完成测量。在这样的情景下，电子体测枪就能够很多克服传统的体温计的缺点，从而得到了市场的认可，特别是在2020年，全球疫情的迅速发展情况中，体温枪在防疫工作中取到了至关重要的作用。

一、项目搭建过程

	1、一键唤醒，实现低功耗的功能
	
		(1)硬件：KEY1(对应开发板的PA0)
		
		(2)方法：使用STM32F407芯片的待命模式（作用：关闭所有1.8V区域的时钟，HSI和HSE的振荡器关闭）,以此达到低功耗的作用。
		通过触发外部中断（EXTI0）从运行模式进入待命模式，然后KEY1（PA0）的一个上升沿唤醒，退出待命模式。（注：因为从待命
		模式进入运行模式只需要一个上升沿，而按下KEY1,肯定有很多个上升沿，过多的上升沿等复位重新初始化之后，会再次进入中断
		服务函数，重新进入待命模式，为了减少这样情况发生，在Wakeup_Init()函数之前delay_ms(1800),以此在EXTI0中断配置好之前
		过滤按键多余的上升沿）
	
	2、支持采集温湿度的功能
	
		(1)硬件模块：DHT11、OLED、定时器3
		
		(2)方法：采用TIM3定时中断，每隔1s从DHT11获取其采集的温湿度，然后把采集的温湿度数据显示到OLED。因为使用封装函数
		OLED_ShowStr(),只能把字符串显示到OLED,所以要先把采集的温湿度转换成字符串。要使用到C语言标准库里的函数：snprintf(),
		这个函数可以把整型或浮点型数据转换成字符串。        

	3、按键触发红外测温传感器采集，并将温度显示在OLED
	
		(1)硬件：KEY2(对应开发板的引脚PE2)、GY-906红外测温传感器、蜂鸣器（使用到开发板的PF8）、OLED
		
		(2)方法：把KEY2配置输入模式，通过读取按键2的状态，进入测温的OLED界面，同时开启GY-906红外测温传感器测温，把采集的温度
		显示到OLED,并且判断测量的温度是否大于设定的报警温度，如果没有大于报警温度，蜂鸣器不响，否则蜂鸣器会响，直至再次按下KEY2
		退出测温界面，蜂鸣器关闭。
	
	4、OLED实时显示时间，并可通过按键调节时间
	
		(1)硬件：OLED、按键KEY2对应开发板的引脚PE2、KEY3(对应开发板的引脚PE3)、KEY4(对应开发板的引脚PE4)、RTC
		
		(2)方法：采用TIM3定时中断，每隔1s从RTC获取时间，并且显示在OLED（同采集的温湿度一起显示在OLED）。通过读取KEY4,进入调节时间
		的OLED界面。在此界面下，按下KEY4,选择要修改的对应的时间对象（有年月日时分秒这六个时间对象）;按下KEY3，选定的时间对象加1(只有加，没有减)，
		如：现在的时间是2020(年)-06(月)-26(日)  18(时)-19(分)-19(秒)，KEY4选定的时间对象是日，那么按下KEY3，时间变为2020(年)-06(月)-27(日)  
		18(时)-19(分)-19(秒)，每次修改时间后，都要写入备份寄存器。按下KEY2,退出调节时间界面。
	
	5、设置报警温度值
	
		(1)硬件：按键KEY2对应开发板的引脚PE2、KEY3(对应开发板的引脚PE3)、KEY4(对应开发板的引脚PE4)、flash
		
		(2)方法：把设置的报警温度写入到FLASH,以防断电丢失。通过读取KEY2,进入设置报警温度值OLED界面。在此界面下，按下KEY3,报警温度值加0.1；
		按下KEY4,报警温度值减0.1；报警温度值范围只能在35.0到38.0变化；按下KEY2,退出设定报警温度值界面
		
	
	

二、接线说明

	1、GY-906红外测温传感器
	
		传感器    ------    开发板(P3)
		
		vin       ------    VCC(3.3v)
		GND       ------    GND
		SCL       ------    PB8
		SDA       ------    PB9
		
	2、OLED
	
		OLED      ------    开发板(TFTLCD)
		
		VCC       ------    PD1
		GND       ------    PD15
		SCK       ------    PE8
		SDA       ------    PE10
		
	3、DHT11
		
		传感器    ------    开发板
		
		VCC       ------    VCC(3.3v)
		GND       ------    GND
		NC        ------    GND
		DQ        ------    PG9
	
	4、供电
		
		USB的AA线 --- 电脑


三、数据协议
	
	1、GY-906红外测温传感器
	
	采用的数据协议：IIC
	
	2、OLED
	
	采用的数据协议：IIC
	



